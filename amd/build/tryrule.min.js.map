{"version":3,"file":"tryrule.min.js","sources":["../src/tryrule.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This class provides functionality for try rule.\n *\n * This is based on the work of Dr Alistair Willis published:\n * http://aclweb.org/anthology/W/W15/W15-0628.pdf\n *\n * @module    qtype_pmatch\n * @class     tryrule\n * @copyright 2016 The Open University\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since     2.9\n */\ndefine(['jquery'], function($) {\n\n    /**\n     * @alias qtype_pmatch/tryrule\n     */\n    const t = {\n        baseUrl: '',\n        sessKey: '',\n        qid: '',\n        pendingid: '',\n        baseForm: null,\n\n        /**\n         * Initialise the try rule button.\n         */\n        init: function() {\n            // Set up base variables.\n            t.pendingid = 'tryrule_' + Math.random().toString(36).slice(2); // Random string.\n            t.baseUrl = M.cfg.wwwroot + '/question/type/pmatch/api/api.php';\n            if ($('#mform1').length) {\n                t.baseForm = $('#mform1');\n            } else {\n                // Get the first form in the page.\n                t.baseForm = $('form.mform').first();\n            }\n            t.sessKey = t.baseForm.find('input[name=\"sesskey\"]').val();\n            t.qid = t.baseForm.find('input[name=\"id\"]').val();\n            $('input[name=\"tryrule\"]').on('click', function(e) {\n                e.preventDefault();\n                const id = $(this).parents('.try-rule').prevAll('.answer-rule').first()\n                    .attr('id').replace('fitem_id_answer_', '');\n                t.tryrule(id, this);\n            });\n        },\n        /**\n         * Try rule support send request try rule.\n         *\n         * @param {number} id id answer try rule\n         * @param {Element} btn is element button click call tryrule function\n         */\n        tryrule: function(id, btn) {\n            M.util.js_pending(t.pendingid);\n            const rule = $('#id_answer_' + id).val().trim();\n            if (rule === undefined || rule === null || rule === '') {\n                return;\n            }\n            const display = $(btn).next('.try-rule-result');\n            const fraction = $('#id_fraction_' + id).val();\n            // Send request for tryrule result.\n            const data = {type: 'tryrule', qid: t.qid, ruletxt: rule, sesskey: t.sessKey, fraction: fraction};\n            $.post(t.baseUrl, data, function(result) {\n                // Display feedback to the user.\n                display.html(result);\n                M.util.js_complete(t.pendingid);\n            }, 'json');\n        }\n    };\n\n    return t;\n});\n"],"names":["define","$","t","baseUrl","sessKey","qid","pendingid","baseForm","init","Math","random","toString","slice","M","cfg","wwwroot","length","first","find","val","on","e","preventDefault","id","this","parents","prevAll","attr","replace","tryrule","btn","util","js_pending","rule","trim","display","next","fraction","data","type","ruletxt","sesskey","post","result","html","js_complete"],"mappings":";;;;;;;;;;;;AA2BAA,8BAAO,CAAC,WAAW,SAASC,SAKlBC,EAAI,CACNC,QAAS,GACTC,QAAS,GACTC,IAAK,GACLC,UAAW,GACXC,SAAU,KAKVC,KAAM,WAEFN,EAAEI,UAAY,WAAaG,KAAKC,SAASC,SAAS,IAAIC,MAAM,GAC5DV,EAAEC,QAAUU,EAAEC,IAAIC,QAAU,oCACxBd,EAAE,WAAWe,OACbd,EAAEK,SAAWN,EAAE,WAGfC,EAAEK,SAAWN,EAAE,cAAcgB,QAEjCf,EAAEE,QAAUF,EAAEK,SAASW,KAAK,yBAAyBC,MACrDjB,EAAEG,IAAMH,EAAEK,SAASW,KAAK,oBAAoBC,MAC5ClB,EAAE,yBAAyBmB,GAAG,SAAS,SAASC,GAC5CA,EAAEC,uBACIC,GAAKtB,EAAEuB,MAAMC,QAAQ,aAAaC,QAAQ,gBAAgBT,QAC3DU,KAAK,MAAMC,QAAQ,mBAAoB,IAC5C1B,EAAE2B,QAAQN,GAAIC,UAStBK,QAAS,SAASN,GAAIO,KAClBjB,EAAEkB,KAAKC,WAAW9B,EAAEI,iBACd2B,KAAOhC,EAAE,cAAgBsB,IAAIJ,MAAMe,UACrCD,MAAAA,MAAgD,KAATA,kBAGrCE,QAAUlC,EAAE6B,KAAKM,KAAK,oBACtBC,SAAWpC,EAAE,gBAAkBsB,IAAIJ,MAEnCmB,KAAO,CAACC,KAAM,UAAWlC,IAAKH,EAAEG,IAAKmC,QAASP,KAAMQ,QAASvC,EAAEE,QAASiC,SAAUA,UACxFpC,EAAEyC,KAAKxC,EAAEC,QAASmC,MAAM,SAASK,QAE7BR,QAAQS,KAAKD,QACb9B,EAAEkB,KAAKc,YAAY3C,EAAEI,aACtB,iBAIJJ"}