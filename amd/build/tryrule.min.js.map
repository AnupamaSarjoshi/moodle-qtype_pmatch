{"version":3,"file":"tryrule.min.js","sources":["../src/tryrule.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This class provides functionality for try rule.\n *\n * This is based on the work of Dr Alistair Willis published:\n * http://aclweb.org/anthology/W/W15/W15-0628.pdf\n *\n * @module    qtype_pmatch\n * @class     tryrule\n * @copyright 2016 The Open University\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since     2.9\n */\ndefine(['jquery'], function($) {\n\n    /**\n     * @alias qtype_pmatch/tryrule\n     */\n    const t = {\n        baseUrl: '',\n        sessKey: '',\n        qid: '',\n        pendingid: '',\n        baseForm: null,\n\n        /**\n         * Initialise the try rule button.\n         */\n        init: function() {\n            // Set up base variables.\n            t.pendingid = 'tryrule_' + Math.random().toString(36).slice(2); // Random string.\n            const base = window.location;\n            t.baseUrl = base.protocol + '//' + base.host +\n                    base.pathname.replace('question.php', 'type/pmatch/api/api.php');\n            if ($('#mform1').length) {\n                t.baseForm = $('#mform1');\n            } else {\n                // Get the first form in the page.\n                t.baseForm = $('form.mform').first();\n            }\n            t.sessKey = t.baseForm.find('input[name=\"sesskey\"]').val();\n            t.qid = t.baseForm.find('input[name=\"id\"]').val();\n            $('input[name=\"tryrule\"]').on('click', function(e) {\n                e.preventDefault();\n                const id = $(this).parents('.try-rule').prevAll('.answer-rule').first()\n                    .attr('id').replace('fitem_id_answer_', '');\n                t.tryrule(id, this);\n            });\n        },\n        /**\n         * Try rule support send request try rule.\n         *\n         * @param {number} id id answer try rule\n         * @param {Element} btn is element button click call tryrule function\n         */\n        tryrule: function(id, btn) {\n            M.util.js_pending(t.pendingid);\n            const rule = $('#id_answer_' + id).val().trim();\n            if (rule === undefined || rule === null || rule === '') {\n                return;\n            }\n            const display = $(btn).next('.try-rule-result');\n            const fraction = $('#id_fraction_' + id).val();\n            // Send request for tryrule result.\n            const data = {type: 'tryrule', qid: t.qid, ruletxt: rule, sesskey: t.sessKey, fraction: fraction};\n            $.post(t.baseUrl, data, function(result) {\n                // Display feedback to the user.\n                display.html(result);\n                M.util.js_complete(t.pendingid);\n            }, 'json');\n        }\n    };\n\n    return t;\n});\n"],"names":["define","$","t","baseUrl","sessKey","qid","pendingid","baseForm","init","Math","random","toString","slice","base","window","location","protocol","host","pathname","replace","length","first","find","val","on","e","preventDefault","id","this","parents","prevAll","attr","tryrule","btn","M","util","js_pending","rule","trim","display","next","fraction","data","type","ruletxt","sesskey","post","result","html","js_complete"],"mappings":";;;;;;;;;;;;AA2BAA,8BAAO,CAAC,WAAW,SAASC,SAKlBC,EAAI,CACNC,QAAS,GACTC,QAAS,GACTC,IAAK,GACLC,UAAW,GACXC,SAAU,KAKVC,KAAM,WAEFN,EAAEI,UAAY,WAAaG,KAAKC,SAASC,SAAS,IAAIC,MAAM,SACtDC,KAAOC,OAAOC,SACpBb,EAAEC,QAAUU,KAAKG,SAAW,KAAOH,KAAKI,KAChCJ,KAAKK,SAASC,QAAQ,eAAgB,2BAC1ClB,EAAE,WAAWmB,OACblB,EAAEK,SAAWN,EAAE,WAGfC,EAAEK,SAAWN,EAAE,cAAcoB,QAEjCnB,EAAEE,QAAUF,EAAEK,SAASe,KAAK,yBAAyBC,MACrDrB,EAAEG,IAAMH,EAAEK,SAASe,KAAK,oBAAoBC,MAC5CtB,EAAE,yBAAyBuB,GAAG,SAAS,SAASC,GAC5CA,EAAEC,uBACIC,GAAK1B,EAAE2B,MAAMC,QAAQ,aAAaC,QAAQ,gBAAgBT,QAC3DU,KAAK,MAAMZ,QAAQ,mBAAoB,IAC5CjB,EAAE8B,QAAQL,GAAIC,UAStBI,QAAS,SAASL,GAAIM,KAClBC,EAAEC,KAAKC,WAAWlC,EAAEI,iBACd+B,KAAOpC,EAAE,cAAgB0B,IAAIJ,MAAMe,UACrCD,MAAAA,MAAgD,KAATA,kBAGrCE,QAAUtC,EAAEgC,KAAKO,KAAK,oBACtBC,SAAWxC,EAAE,gBAAkB0B,IAAIJ,MAEnCmB,KAAO,CAACC,KAAM,UAAWtC,IAAKH,EAAEG,IAAKuC,QAASP,KAAMQ,QAAS3C,EAAEE,QAASqC,SAAUA,UACxFxC,EAAE6C,KAAK5C,EAAEC,QAASuC,MAAM,SAASK,QAE7BR,QAAQS,KAAKD,QACbb,EAAEC,KAAKc,YAAY/C,EAAEI,aACtB,iBAIJJ"}