define(["jquery"],function(a){var b={baseUrl:"",sessKey:"",qid:"",pendingid:"",enablebtn:[],init:function(){b.pendingid="tryrule_"+Math.random().toString(36).slice(2);var c=window.location;b.baseUrl=c.protocol+"//"+c.host+c.pathname.replace("question.php","type/pmatch/api/tryrule.php"),b.sessKey=a('#mform1 input[name="sesskey"]').val(),b.qid=a('#mform1 input[name="id"]').val(),a(".textareamonospace").each(function(){var c=a(this).attr("id").replace("id_answer_","");a(this).parent().parent().next().next().find("input").attr("id","id_tryrule_"+c),a(this).on("change",function(d){d.preventDefault(),-1===b.enablebtn.indexOf(c)&&(b.enablebtn.push(c),a('input[id="id_tryrule_'+c+'"]').removeAttr("disabled"))})}),a('input[name="tryrule"]').on("click",function(c){c.preventDefault();var d=a(this).attr("id").replace("id_tryrule_","");-1!==b.enablebtn.indexOf(d)&&b.tryrule(d)})},tryrule:function(c){M.util.js_pending(b.pendingid);var d=a("#id_answer_"+c).val();if(void 0===d||null===d||""===d)return!1;if(d=d.trim(),""===d)return!1;var e=a("#id_tryrule_"+c).next(),f=a("#id_fraction_"+c).val(),g={qid:b.qid,ruletxt:d,sesskey:b.sessKey,grade:f};a.post(b.baseUrl,g,function(a){e.html(a),M.util.js_complete(b.pendingid)},"json")}};return b});