/**
 * This class provides functionality for the testquestion response updater.
 *
 * @module    qtype_pmatch
 * @class     updater
 * @copyright 2016 The Open University
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("qtype_pmatch/updater",["jquery","core/notification"],(function($,Notification){const t={baseUrl:"",sessKey:"",qid:"",headerCheckboxChecked:!0,REPLACESTRING:/qtype-pmatch-testquestion_r/g,init:function(){const base=$("#attemptsform").attr("action"),body=$("body");t.baseUrl=base.replace("testquestion.php","api/updater.php"),t.sessKey=$('#attemptsform input[name="sesskey"]').val(),t.qid=$('#attemptsform input[name="id"]').val(),$(document).on("click",".updater-ef",(function(){const id=$(this).data("id");return t.update(id),!1})),$(document).on("keypress","#tablecontainer :checkbox",(function(e){13===(e.keyCode?e.keyCode:e.which)&&(e.preventDefault(),$(this).trigger("click"))})),$("#tqheadercheckbox").click((function(){t.headerCheckboxChecked?($(this).attr("title",M.util.get_string("deselectall","moodle")),t.headerCheckboxChecked=!1):($(this).attr("title",M.util.get_string("selectall","moodle")),t.headerCheckboxChecked=!0),$("#tablecontainer :checkbox").each((function(){this.checked=!t.headerCheckboxChecked})),$(this).prop("checked",!1)})),body.on("updatefailed","[data-inplaceeditable]",(function(e){const exception=e.exception;e.preventDefault(),Notification.alert(M.util.get_string("error:title","qtype_pmatch"),exception.message,M.util.get_string("ok","moodle"))})),body.on("updated","[data-inplaceeditable]",(function(e){t.handleUpdated(e,this)})),t.bindInplaceEditEvent()},bindInplaceEditEvent:function(){$("#qtype-pmatch-testquestion_r0").hasClass("emptyrow")&&require(["core/inplace_editable"])},handleUpdated:function(e,target){const ajaxReturn=e.ajaxreturn;if(ajaxReturn.value!==e.oldvalue){const jsonDecode=$.parseJSON(ajaxReturn.value),row=$(target).parent().parent(),currentRow=row.attr("id"),html=jsonDecode.html;$(row).replaceWith(html.replace(t.REPLACESTRING,currentRow)),$("#testquestion_gradesummary").html(jsonDecode.summary)}},update:function(id){const ef="1"===$("#updater-ef_"+id).text()?0:1,data={qid:t.qid,rid:id,expectedfraction:ef,sesskey:t.sessKey};$.post(t.baseUrl,data,(function(result){if("success"===result.status){const updater=$("#updater-ef_"+id);updater.text(result.ef),updater.parent().prev().text(result.gf);const tr=updater.parent().parent();tr.removeClass(),tr.addClass(result.rowclass),tr.find('td[class="c3"]').text(result.gf);const c=M.util.get_string("testquestionresultssummary","qtype_pmatch",result.counts);$("#testquestion_gradesummary").html(c)}else window.console.log("Testquestion response updater has experienced an issue.\n"+result.data)}))}};return t}));

//# sourceMappingURL=updater.min.js.map